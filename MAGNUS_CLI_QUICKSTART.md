# Magnus CLI - Quick Start Guide

## What is Magnus CLI?

Magnus CLI is a non-interactive command-line wrapper for **Magnus 13.2 Hermetic Edition** that validates code convergence without human intervention. It's designed for autonomous agent workflows (like Kilo) that need automated code validation.

## Installation

The CLI is already available in your Magnus environment:

```bash
# Direct execution
node magnus-cli.js --mode validate-convergence \
  --session-id "my-session" \
  --code-path "./solution.js"

# Using npm script (after install)
npm run validate:convergence -- \
  --session-id "my-session" \
  --code-path "./solution.js"
```

## 30-Second Example

```bash
# Validate your generated code
node magnus-cli.js \
  --mode validate-convergence \
  --session-id "test-001" \
  --code-path "./my-solution.js"

# Check result
echo "Exit code: $?"
# 0 = CONVERGED ✅
# 1 = PARTIAL ⚠️
# 2 = FAILED ❌
```

## Core Arguments

| Argument | Required | Example | Purpose |
|----------|----------|---------|---------|
| `--mode` | Yes | `validate-convergence` | Operation mode |
| `--session-id` | Yes | `my-task-001` | Track this validation |
| `--code-path` | Yes | `./solution.js` | File or directory to validate |
| `--feedback` | No | `"looks good"` | Optional feedback signal |
| `--output` | No | `./report.json` | Report destination |

## 5-Minute Tutorial

### Step 1: Create Some Code
```bash
cat > test-solution.js << 'EOF'
function calculateSum(arr) {
  if (!Array.isArray(arr)) {
    throw new Error('Input must be an array');
  }

  return arr.reduce((sum, num) => sum + num, 0);
}

module.exports = calculateSum;
EOF
```

### Step 2: Run Validation
```bash
node magnus-cli.js \
  --mode validate-convergence \
  --session-id "tutorial-001" \
  --code-path "./test-solution.js" \
  --feedback "looks correct"
```

### Step 3: Check Results
```bash
# View the report
cat ./.magnus/convergence-report.json

# Get the exit code
echo $?
```

### Step 4: Understand the Score
- **Score 85+**: CONVERGED (exit 0) ✅ Ready to use
- **Score 70-84**: PARTIAL (exit 1) ⚠️ Needs work
- **Score <70**: FAILED (exit 2) ❌ Retry

## Real-World Scenario

### Kilo Agent Integration
```javascript
// In your Kilo agent
const { execSync } = require('child_process');

async function validateCode(code, sessionId) {
  // Write code to file
  fs.writeFileSync('temp-solution.js', code);

  // Run validation
  try {
    execSync(`node magnus-cli.js \
      --mode validate-convergence \
      --session-id "${sessionId}" \
      --code-path "./temp-solution.js" \
      --feedback "Generated by Kilo agent"`);

    return { status: 'CONVERGED', action: 'ACCEPT' };
  } catch (error) {
    if (error.status === 1) {
      return { status: 'PARTIAL', action: 'REFINE' };
    } else {
      return { status: 'FAILED', action: 'RETRY' };
    }
  }
}
```

### CI/CD Pipeline
```yaml
# GitHub Actions
- name: Validate Generated Code
  run: |
    node magnus-cli.js \
      --mode validate-convergence \
      --session-id "github-${{ github.run_id }}" \
      --code-path "./src/generated"

    if [ $? -ne 0 ]; then
      echo "❌ Code validation failed"
      exit 1
    fi
```

## What Gets Validated?

Magnus CLI analyzes 5 key aspects:

| Aspect | What It Checks | Impact |
|--------|----------------|--------|
| **Code Quality** | Size, documentation, error handling | 25% |
| **Semantic Alignment** | Patterns, identifiers, structure | 25% |
| **Historical Convergence** | Matches previous solutions | 25% |
| **Bloc Convergence** | Structural robustness analysis | 15% |
| **Feedback** | Your assessment signal | 10% |

## Exit Codes

| Code | Status | Meaning | Action |
|------|--------|---------|--------|
| 0 | ✅ CONVERGED | Solution accepted | Use immediately |
| 1 | ⚠️ PARTIAL | Solution needs work | Request refinement |
| 2 | ❌ FAILED | Solution rejected | Retry/regenerate |

## Report Structure

The JSON report includes:

```json
{
  "sessionId": "test-001",
  "timestamp": "2026-02-27T...",
  "mode": "ORCHESTRATED",
  "analysis": {
    "codeQuality": { "score": 85, ... },
    "semanticAlignment": { "score": 70, ... },
    "historicalConvergence": { ... },
    "blocConvergence": { ... },
    "feedback": { "text": "...", "score": 0.9 }
  },
  "finalScore": 78,
  "result": "PARTIAL",
  "recommendations": [
    "◐ Solution partially converged",
    "→ Address quality gaps",
    "→ Current score: 78%, target: 85%"
  ]
}
```

## Common Patterns

### Check If Converged
```bash
if node magnus-cli.js --mode validate-convergence \
   --session-id "check" --code-path "./code.js"; then
  echo "✅ Code converged!"
else
  echo "Code needs work (exit code: $?)"
fi
```

### Batch Validation
```bash
for file in solutions/*.js; do
  node magnus-cli.js \
    --mode validate-convergence \
    --session-id "batch-$(basename $file)" \
    --code-path "$file"

  [ $? -eq 0 ] && cp "$file" approved/
done
```

### With Custom Report Path
```bash
node magnus-cli.js \
  --mode validate-convergence \
  --session-id "my-task" \
  --code-path "./solution.js" \
  --output "./reports/my-task-result.json"
```

## Feedback Keywords

The CLI recognizes your feedback:

**Positive**: `good`, `excellent`, `perfect`, `great`, `correct` → Score 0.9
**Negative**: `bad`, `poor`, `wrong`, `broken`, `fail` → Score 0.1
**Partial**: `partial`, `needs`, `improve`, `refactor` → Score 0.5

## Tips & Best Practices

### ✅ DO
- Use descriptive session IDs
- Include meaningful feedback
- Check exit codes in scripts
- Review reports for insights
- Run in CI/CD pipelines

### ❌ DON'T
- Pass binary files to `--code-path`
- Ignore exit codes
- Assume high scores without checking details
- Run without session tracking
- Modify generated reports manually

## Troubleshooting

### "Code path not found"
```bash
# Verify the file exists
ls -la ./solution.js

# Use absolute path if relative fails
node magnus-cli.js --code-path "$PWD/solution.js" ...
```

### "Exit code 2 unexpectedly"
1. Check the report: `cat ./.magnus/convergence-report.json`
2. Review "recommendations" section
3. Look at lowest-scoring aspect
4. Improve that area and retry

### Reports not appearing
```bash
# Check if directory exists
ls -la ./.magnus/

# Check permissions
chmod -R 755 ./.magnus/
```

## Next Steps

- Read **MAGNUS_CLI_GUIDE.md** for comprehensive documentation
- Check **examples/magnus-cli-demo.js** for code examples
- Review your convergence reports regularly
- Integrate into your CI/CD workflow

## Quick Reference

```bash
# Basic validation
node magnus-cli.js --mode validate-convergence \
  --session-id SESSION_ID --code-path CODE_PATH

# Full featured
node magnus-cli.js --mode validate-convergence \
  --session-id SESSION_ID \
  --code-path CODE_PATH \
  --feedback "FEEDBACK_TEXT" \
  --output REPORT_PATH

# Check script
if [ $? -eq 0 ]; then echo "✅"; else echo "❌"; fi
```

---

**Need more help?** See `MAGNUS_CLI_GUIDE.md` for the complete reference.
