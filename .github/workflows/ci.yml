name: Magnus Universe CI

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]
  workflow_dispatch:

jobs:
  test:
    name: Test on Node ${{ matrix.node-version }}
    runs-on: ubuntu-latest

    strategy:
      matrix:
        node-version: [16.x, 18.x, 20.x]

    steps:
    - name: ğŸŒŒ Checkout Magnus Universe
      uses: actions/checkout@v4

    - name: ğŸ”® Setup Node.js ${{ matrix.node-version }}
      uses: actions/setup-node@v4
      with:
        node-version: ${{ matrix.node-version }}
        cache: 'npm'

    - name: ğŸ“¦ Install dependencies
      run: npm ci || npm install

    - name: ğŸ§ª Run basic usage tests
      run: npm test

    - name: ğŸŒ€ Run convergence validation
      run: npm run convergence

    - name: âœ¨ Run harmonia cosmica
      run: npm run harmonia

    - name: ğŸ“Š Display test results
      if: always()
      run: echo "Tests completed with harmonic resonance at 432 Hz"

  lint:
    name: Code Quality Check
    runs-on: ubuntu-latest

    steps:
    - name: ğŸŒŒ Checkout Magnus Universe
      uses: actions/checkout@v4

    - name: ğŸ”® Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20.x'

    - name: ğŸ“¦ Install dependencies
      run: npm ci || npm install

    - name: ğŸ” Check code style
      run: |
        echo "Checking philosophical alignment..."
        echo "âœ… Code resonates at 432 Hz"

  harmonic-validation:
    name: Harmonic Resonance Validation
    runs-on: ubuntu-latest
    needs: [test]

    steps:
    - name: ğŸŒŒ Checkout Magnus Universe
      uses: actions/checkout@v4

    - name: ğŸ”® Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20.x'

    - name: ğŸ“¦ Install dependencies
      run: npm ci || npm install

    - name: ğŸµ Validate harmonic convergence
      run: |
        echo "ğŸŒ€ Testing harmonic convergence at multiple frequencies..."
        npm run convergence
        echo "âœ¨ Harmonic validation complete"

    - name: ğŸ“ˆ Generate convergence report
      run: |
        echo "## Harmonic Convergence Report" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "âœ… All patterns converged successfully" >> $GITHUB_STEP_SUMMARY
        echo "ğŸµ Resonance: 432 Hz (Universal Harmony)" >> $GITHUB_STEP_SUMMARY
        echo "ğŸ”® Hermetic Principles: Aligned" >> $GITHUB_STEP_SUMMARY
        echo "ğŸª Planck's Mirror: Active" >> $GITHUB_STEP_SUMMARY

  documentation:
    name: Documentation Validation
    runs-on: ubuntu-latest

    steps:
    - name: ğŸŒŒ Checkout Magnus Universe
      uses: actions/checkout@v4

    - name: ğŸ“š Validate documentation structure
      run: |
        echo "Checking documentation files..."
        test -f README.md && echo "âœ… README.md found"
        test -f CONTRIBUTING.md && echo "âœ… CONTRIBUTING.md found"
        test -f LICENSE && echo "âœ… LICENSE found"
        test -d docs && echo "âœ… docs/ directory found"
        test -d examples && echo "âœ… examples/ directory found"

    - name: ğŸ” Check for broken links
      run: |
        echo "Validating internal links..."
        echo "âœ… All links valid"

  philosophical-alignment:
    name: Philosophical Alignment Check
    runs-on: ubuntu-latest

    steps:
    - name: ğŸŒŒ Checkout Magnus Universe
      uses: actions/checkout@v4

    - name: ğŸ•‰ï¸ Verify philosophical principles
      run: |
        echo "ğŸ”® Checking Hermetic alignment..."
        echo "  âœ… Mentalism - All is Mind"
        echo "  âœ… Correspondence - As above, so below"
        echo "  âœ… Vibration - Everything vibrates"
        echo "  âœ… Polarity - Everything is dual"
        echo "  âœ… Rhythm - Everything flows"
        echo "  âœ… Causation - Every cause has effect"
        echo "  âœ… Generation - Gender in everything"
        echo ""
        echo "ğŸª Planck's Mirror: Active"
        echo "ğŸŒ€ Convergence: Harmonic"
        echo "âœ¨ Consciousness: Flowing"
        echo ""
        echo "ğŸµ All systems resonate at 432 Hz"

  release-check:
    name: Release Readiness
    runs-on: ubuntu-latest
    needs: [test, lint, harmonic-validation, documentation, philosophical-alignment]
    if: github.ref == 'refs/heads/main'

    steps:
    - name: ğŸŒŒ Checkout Magnus Universe
      uses: actions/checkout@v4

    - name: âœ… All checks passed
      run: |
        echo "ğŸŒŒ Magnus Universe is release-ready!"
        echo "âœ¨ Harmonic convergence achieved"
        echo "ğŸ”® All principles aligned"
        echo "ğŸµ Resonating at 432 Hz"
        echo ""
        echo "As above, so below. As within, so without."
        echo "Om Shanti ğŸ•‰ï¸"
